import streamlit as st
import pandas as pd
import os

st.set_page_config(page_title="MealMatch ЁЯН╜я╕П", layout="centered")
st.title("ЁЯН╜я╕П MealMatch - р╕бр╕╖р╣Йр╕нр╣Др╕лр╕Щр╕Фр╕╡?")

# === р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Бр╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й ===
user_location = st.selectbox("ЁЯУН р╕Ър╕гр╕┤р╣Ар╕зр╕Ур╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ир╕░р╣Др╕Ы", ["р╕Ыр╕гр╕░р╕Хр╕╣ 1", "р╕Ыр╕гр╕░р╕Хр╕╣ 2", "р╕Ыр╕гр╕░р╕Хр╕╣ 3", "р╕Ыр╕гр╕░р╕Хр╕╣ 4"])
user_choice = st.selectbox("ЁЯН▒ р╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕нр╕▓р╕лр╕▓р╕г", ["р╕нр╕▓р╕лр╕▓р╕гр╕Хр╕▓р╕бр╕кр╕▒р╣Ир╕З", "р╕нр╕▓р╕лр╕▓р╕гр╕нр╕╡р╕кр╕▓р╕Щ", "р╕нр╕▓р╕лр╕▓р╕гр╕Ир╕▓р╕Щр╣Ар╕Фр╕╡р╕вр╕з", "р╕Ыр╕┤р╣Йр╕Зр╕вр╣Ир╕▓р╕З", "р╕нр╕▓р╕лр╕▓р╕гр╣Ар╕Бр╕▓р╕лр╕ер╕╡", "р╕нр╕▓р╕лр╕▓р╕гр╕Нр╕╡р╣Ир╕Ыр╕╕р╣Ир╕Щ"])
user_budget = st.radio("ЁЯТ╕ р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Хр╣Ир╕нр╕бр╕╖р╣Йр╕н (р╕Ър╕▓р╕Ч)", ["р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 50", "50 - 100", "100 - 200", "200+"])
user_time = st.selectbox("тП░ р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕бр╕▒р╕Бр╕нр╕нр╕Бр╣Др╕Ыр╕Бр╕┤р╕Щ", ["р╣Ар╕Кр╣Йр╕▓", "р╕Бр╕ер╕▓р╕Зр╕зр╕▒р╕Щ", "р╣Ар╕вр╣Зр╕Щ"])

# === р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╣Йр╕▓р╕Щр╕нр╕▓р╕лр╕▓р╕гр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З ===
data = {
    "name": ["р╕гр╣Йр╕▓р╕Щ A", "р╕гр╣Йр╕▓р╕Щ B", "р╕гр╣Йр╕▓р╕Щ C", "р╕гр╣Йр╕▓р╕Щ D", "р╕гр╣Йр╕▓р╕Щ E", "р╕гр╣Йр╕▓р╕Щ F"],
    "location": ["р╕Ыр╕гр╕░р╕Хр╕╣ 1", "р╕Ыр╕гр╕░р╕Хр╕╣ 1", "р╕Ыр╕гр╕░р╕Хр╕╣ 3", "р╕Ыр╕гр╕░р╕Хр╕╣ 4", "р╕Ыр╕гр╕░р╕Хр╕╣ 1", "р╕Ыр╕гр╕░р╕Хр╕╣ 2"],
    "choice": ["р╕нр╕▓р╕лр╕▓р╕гр╕Хр╕▓р╕бр╕кр╕▒р╣Ир╕З", "р╕нр╕▓р╕лр╕▓р╕гр╕Хр╕▓р╕бр╕кр╕▒р╣Ир╕З", "р╕нр╕▓р╕лр╕▓р╕гр╕Ир╕▓р╕Щр╣Ар╕Фр╕╡р╕вр╕з", "р╕Ыр╕┤р╣Йр╕Зр╕вр╣Ир╕▓р╕З", "р╕нр╕▓р╕лр╕▓р╕гр╣Ар╕Бр╕▓р╕лр╕ер╕╡", "р╕нр╕▓р╕лр╕▓р╕гр╕Нр╕╡р╣Ир╕Ыр╕╕р╣Ир╕Щ"],
    "budget": ["50 - 100", "50 - 100", "50 - 100", "200+", "100 - 200", "50 - 100"],
    "time": ["р╕Бр╕ер╕▓р╕Зр╕зр╕▒р╕Щ", "р╕Бр╕ер╕▓р╕Зр╕зр╕▒р╕Щ", "р╣Ар╕Кр╣Йр╕▓", "р╕Бр╕ер╕▓р╕Зр╕зр╕▒р╕Щ", "р╣Ар╕вр╣Зр╕Щ", "р╣Ар╕Кр╣Йр╕▓"]
}
df = pd.DataFrame(data)

# === р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Бр╕гр╕нр╕Зр╕гр╣Йр╕▓р╕Щ ===
def filter_restaurants(location, food_type, price_range, time_of_day):
    return df[
        (df['location'] == location) &
        (df['choice'] == food_type) &
        (df['budget'] == price_range) &
        (df['time'] == time_of_day)
    ]['name'].tolist()

# === р╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╕Др╣Йр╕Щр╕лр╕▓ ===
if st.button("ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕гр╣Йр╕▓р╕Щр╕нр╕▓р╕лр╕▓р╕г"):
    matched_restaurants = filter_restaurants(user_location, user_choice, user_budget, user_time)

    if matched_restaurants:
        st.success("р╕гр╣Йр╕▓р╕Щр╕Чр╕╡р╣Ир╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Др╕╕р╕Ур╕бр╕╡р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й ЁЯНЬ")
        selected_store = st.radio("ЁЯУМ р╣Ар╕ер╕╖р╕нр╕Бр╕гр╣Йр╕▓р╕Щр╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕кр╕Щр╣Гр╕И:", matched_restaurants)

        if st.button("тЬЕ р╕Йр╕▒р╕Щр╣Ар╕ер╕╖р╕нр╕Бр╕гр╣Йр╕▓р╕Щр╕Щр╕╡р╣Й"):
            new_feedback = pd.DataFrame([{
                "location": user_location,
                "choice": user_choice,
                "budget": user_budget,
                "time": user_time,
                "selected_store": selected_store
            }])

            # р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З CSV
            if os.path.exists("user_feedback.csv"):
                new_feedback.to_csv("user_feedback.csv", mode="a", header=False, index=False)
            else:
                new_feedback.to_csv("user_feedback.csv", index=False)

            st.success(f"р╕Др╕╕р╕Ур╣Ар╕ер╕╖р╕нр╕Бр╕гр╣Йр╕▓р╕Щ: {selected_store} тЬЕ р╕Вр╕нр╕Ър╕Др╕╕р╕Ур╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Б!")

    else:
        st.error("р╣Др╕бр╣Ир╕Юр╕Ър╕гр╣Йр╕▓р╕Щр╕нр╕▓р╕лр╕▓р╕гр╕Чр╕╡р╣Ир╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Бр╕Вр╕нр╕Зр╕Др╕╕р╕У ЁЯШе р╕ер╕нр╕Зр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕╣р╕Щр╕░")

        if st.button("тЭМ р╣Др╕бр╣Ир╕бр╕╡р╕гр╣Йр╕▓р╕Щр╣Др╕лр╕Щр╕Чр╕╡р╣Ир╕Хр╕гр╕Зр╣Гр╕И"):
            new_feedback = pd.DataFrame([{
                "location": user_location,
                "choice": user_choice,
                "budget": user_budget,
                "time": user_time,
                "selected_store": "р╣Др╕бр╣Ир╕бр╕╡р╕гр╣Йр╕▓р╕Щр╕Чр╕╡р╣Ир╕Хр╕гр╕Зр╣Гр╕И"
            }])

            if os.path.exists("user_feedback.csv"):
                new_feedback.to_csv("user_feedback.csv", mode="a", header=False, index=False)
            else:
                new_feedback.to_csv("user_feedback.csv", index=False)

            st.warning("р╕Вр╕нр╕Ър╕Др╕╕р╕Ур╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╣Ар╕лр╣Зр╕Щ! р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Щр╕│р╣Др╕Ыр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Хр╣Ир╕нр╣Др╕Ы ЁЯЩП")

# === р╣Бр╕кр╕Фр╕З Feedback р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф ===
if os.path.exists("user_feedback.csv") and os.path.getsize("user_feedback.csv") > 0:
    feedback_df = pd.read_csv("user_feedback.csv")
    st.markdown("---")
    st.markdown("### ЁЯУЭ р╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╣Ар╕лр╣Зр╕Щр╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Бр╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓")
    st.dataframe(feedback_df)
    st.info(f"ЁЯУК р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Чр╕│р╣Бр╕Ър╕Ър╕кр╕нр╕Ър╕Цр╕▓р╕б: {len(feedback_df)} р╕Др╕гр╕▒р╣Йр╕З")
